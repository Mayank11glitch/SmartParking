<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Parking â€” Login</title>
  <link rel="stylesheet" href="styles.css">

  <!-- Firebase SDKs -->
  <script type="module">
    // Import Firebase functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // ðŸ”¥ YOUR FIREBASE CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyCHrwLfSCIuLvC7VqhpX-u_jUaW2AwDauU",
      authDomain: "smartparkingfinal-8c79e.firebaseapp.com",
      databaseURL: "https://smartparkingfinal-8c79e-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "smartparkingfinal-8c79e",
      storageBucket: "smartparkingfinal-8c79e.firebasestorage.app",
      messagingSenderId: "855138079664",
      appId: "1:855138079664:web:78fd5da08725e5d9abbc75"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Make auth functions available globally
    window.firebaseAuth = auth;
    window.firebaseLogin = signInWithEmailAndPassword;
    window.firebaseRegister = createUserWithEmailAndPassword;
    window.firebaseUpdateProfile = updateProfile;
  </script>

</head>

<body>

  <div class="bg-blob blob-1" style="opacity: 0.2;"></div>
  <div class="bg-blob blob-2" style="opacity: 0.2;"></div>

  <header>
    <div class="container">
      <div class="brand">
        <div class="brand-logo">SP</div>
        <span>Smart Parking</span>
      </div>
      <nav class="nav-links">
        <a href="index.html" class="nav-link">Home</a>
        <a href="contact.html" class="nav-link">Contact</a>
        <button id="themeToggleBtn" class="btn btn-outline"
          style="border-radius:50%; padding:8px; width:40px; height:40px; display:inline-flex; align-items:center; justify-content:center; margin-left:8px;"
          aria-label="Toggle Theme">
          <!-- Icon will be injected by theme.js -->
        </button>
      </nav>
    </div>
  </header>

  <main class="container reveal">
    <div class="split-section" style="min-height: calc(100vh - 160px);">
      <!-- Hero Side -->
      <div style="align-self: flex-start; margin-top: 100px;">
        <h1 style="font-size: 3.5rem; line-height: 1.1; margin-bottom: 24px;">
          Welcome <span class="text-gradient">Back</span>
        </h1>
        <p class="hero-lead" style="text-align: left; margin-bottom: 40px;">
          Access your smart parking dashboard, manage reservations, and view your history.
        </p>

        <div style="display: flex; gap: 24px;">
          <div class="glass-panel" style="padding: 20px; border-radius: 12px; flex: 1;">
            <div style="font-size: 2rem; font-weight: 700; color: var(--color-info);">Fast</div>
            <div style="color: var(--text-muted); font-size: 0.9rem;">Seamless booking</div>
          </div>
          <div class="glass-panel" style="padding: 20px; border-radius: 12px; flex: 1;">
            <div style="font-size: 2rem; font-weight: 700; color: var(--color-success);">Secure</div>
            <div style="color: var(--text-muted); font-size: 0.9rem;">Encrypted data</div>
          </div>
        </div>
      </div>

      <!-- Auth Side -->
      <div class="auth-card glass-panel" style="border-radius: 20px; padding: 40px;">
        <div class="auth-tabs">
          <div class="auth-tab active" id="tabLogin" onclick="switchTab('login')">Log In</div>
          <div class="auth-tab" id="tabRegister" onclick="switchTab('register')">Register</div>
        </div>

        <div class="auth-form-container">
          <!-- Login Form -->
          <form id="loginForm" class="active">
            <div class="form-group">
              <label class="form-label">Email Address</label>
              <input type="email" id="loginEmail" class="form-control" placeholder="name@example.com" required>
            </div>
            <div class="form-group">
              <label class="form-label">Password</label>
              <div style="position: relative;">
                <input type="password" id="loginPass" class="form-control" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required
                  style="padding-right: 45px;">
                <button type="button" onclick="togglePassword('loginPass', this)" class="password-toggle"
                  style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; padding: 0; display: flex; align-items: center; justify-content: center; opacity: 0.6; transition: opacity 0.2s;"
                  onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.6'">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
              </div>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">Log In</button>
          </form>

          <!-- Register Form -->
          <form id="registerForm">
            <div class="form-group">
              <label class="form-label">Full Name</label>
              <input type="text" id="regName" class="form-control" placeholder="Ram Kumar" required>
            </div>
            <div class="form-group">
              <label class="form-label">Email Address</label>
              <input type="email" id="regEmail" class="form-control" placeholder="name@example.com" required>
            </div>
            <div class="form-group">
              <label class="form-label">Password</label>
              <div style="position: relative;">
                <input type="password" id="regPass" class="form-control" placeholder="Create a password" required
                  style="padding-right: 45px;">
                <button type="button" onclick="togglePassword('regPass', this)" class="password-toggle"
                  style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; padding: 0; display: flex; align-items: center; justify-content: center; opacity: 0.6; transition: opacity 0.2s;"
                  onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.6'">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
              </div>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">Create Account</button>
          </form>
        </div>



      </div>
    </div>
  </main>

  <div id="toast"></div>

  <script>
    window.addEventListener('load', () => {
      triggerAnimations();
    });

    function triggerAnimations() {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('active');
          }
        });
      }, { threshold: 0.1 });

      document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
    }

    // Toast Notification
    function toast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.style.opacity = '1';
      t.style.transform = 'translateY(0)';
      setTimeout(() => {
        t.style.opacity = '0';
        t.style.transform = 'translateY(-20px)';
      }, 3000);
    }

    // Password Toggle Visibility
    function togglePassword(inputId, button) {
      const input = document.getElementById(inputId);
      const svg = button.querySelector('svg');

      if (input.type === 'password') {
        input.type = 'text';
        svg.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>';
      } else {
        input.type = 'password';
        svg.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
      }
    }

    // Tab Switching
    function switchTab(tab) {
      const loginForm = document.getElementById('loginForm');
      const registerForm = document.getElementById('registerForm');
      const tabLogin = document.getElementById('tabLogin');
      const tabRegister = document.getElementById('tabRegister');

      if (tab === 'login') {
        loginForm.classList.add('active');
        registerForm.classList.remove('active');
        tabLogin.classList.add('active');
        tabRegister.classList.remove('active');
      } else {
        loginForm.classList.remove('active');
        registerForm.classList.add('active');
        tabLogin.classList.remove('active');
        tabRegister.classList.add('active');
      }
    }

    // Crypto Helper (Simple Hash)
    async function sha256(message) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    // Local Storage Helpers
    const USERS_KEY = 'sp_users_v1';
    const CURRENT_USER_KEY = 'sp_current_user_v1';

    function getUsers() {
      return JSON.parse(localStorage.getItem(USERS_KEY) || '[]');
    }

    function saveUser(user) {
      const users = getUsers();
      users.push(user);
      localStorage.setItem(USERS_KEY, JSON.stringify(users));
    }

    // Register Handler
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('regName').value;
      const email = document.getElementById('regEmail').value;
      const pass = document.getElementById('regPass').value;

      if (!name || !email || !pass) return toast('Please fill all fields');

      try {
        // Create user with Firebase Authentication
        const userCredential = await window.firebaseRegister(window.firebaseAuth, email, pass);
        const user = userCredential.user;

        // Update user profile with name
        await window.firebaseUpdateProfile(user, {
          displayName: name
        });

        // Store user info in localStorage
        const userData = {
          id: user.uid,
          firstName: name,
          email: user.email,
          createdAt: new Date().toISOString()
        };
        localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(userData));

        toast('Account created! Redirecting...');
        setTimeout(() => window.location.href = 'dashboard.html', 1500);
      } catch (error) {
        console.error('Registration error:', error);
        if (error.code === 'auth/email-already-in-use') {
          toast('Email already registered');
        } else if (error.code === 'auth/weak-password') {
          toast('Password should be at least 6 characters');
        } else if (error.code === 'auth/invalid-email') {
          toast('Invalid email address');
        } else {
          toast('Registration failed: ' + error.message);
        }
      }
    });

    // Login Handler
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const pass = document.getElementById('loginPass').value;

      if (!email || !pass) return toast('Please fill all fields');

      try {
        // Sign in with Firebase Authentication
        const userCredential = await window.firebaseLogin(window.firebaseAuth, email, pass);
        const user = userCredential.user;

        // Store user info in localStorage
        const userData = {
          id: user.uid,
          firstName: user.displayName || user.email.split('@')[0],
          email: user.email
        };
        localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(userData));

        toast('Welcome back!');
        setTimeout(() => window.location.href = 'dashboard.html', 1000);
      } catch (error) {
        console.error('Login error:', error);
        if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
          toast('Invalid email or password');
        } else if (error.code === 'auth/invalid-email') {
          toast('Invalid email address');
        } else if (error.code === 'auth/too-many-requests') {
          toast('Too many failed attempts. Try again later.');
        } else {
          toast('Login failed: ' + error.message);
        }
      }
    });


  </script>
  <canvas id="flickering-grid"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none;"></canvas>
  <script src="js/flickering-grid.js"></script>
  <script src="js/init-grid.js"></script>
  <script src="js/mobile-menu.js"></script>
  <script src="js/theme.js"></script>
</body>

</html>